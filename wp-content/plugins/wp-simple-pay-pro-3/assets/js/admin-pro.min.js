/*! WP Simple Pay Pro 3 - 3.1.7
 * https://wpsimplepay.com/
 * Copyright (c) Moonstone Media 2017
 * Licensed GPLv2+ */

var spAdminPro={};!function(a){"use strict";var b,c;spAdminPro={init:function(){b=a(document.body),c=b.find("#simpay-form-settings"),this.loadCustomFieldMetaboxes(),this.addDatepicker(),b.on("DOMNodeInserted.simpayDOMNodeInserted",".simpay-custom-fields",this.disableSubscriptions),b.on("DOMNodeRemoved.simpayDOMNodeRemoved",".simpay-custom-fields",this.enableSubscriptions),this.initSortableFields(c.find(".simpay-custom-fields")),c.find(".add-field").on("click.simpayAddField",this.addField),c.find(".simpay-custom-fields").on("click.simpayRemoveField",".simpay-remove-field-link",spAdminPro.removeField),c.find(".simpay-metaboxes-wrapper").on("click.simpayToggleMetabox",".simpay-metabox h3",function(b){spAdminPro.initMetaboxToggle(a(this),b)}),c.on("change.simpayToggleAmountOptions",'.simpay-disable-amount input[type="radio"], .simpay-dropdown-amount, .simpay-radio-amount',function(){spAdminPro.toggleAmountOptions(a(this))}),a(".simpay-tax-percent-field").on("blur.simpayTaxPercentBlur",function(){spAdminPro.handleTaxPercent(a(this))}),c.find(".simpay-custom-field-recurring-amount-toggle").length>0&&c.find('#_subscription_type input[type="radio"]').attr("disabled","disabled")},handleTaxPercent:function(a){a.val(parseFloat(a.val()).toFixed(4))},disableSubscriptions:function(b){var d=b.target,e=c.find('#_subscription_type input[type="radio"]');a(d).hasClass("simpay-custom-field-recurring-amount-toggle")&&(c.find("#_subscription_type-disabled").click(),e.attr("disabled","disabled"))},enableSubscriptions:function(b){var d=b.target,e=c.find('#_subscription_type input[type="radio"]');a(d).hasClass("simpay-custom-field-recurring-amount-toggle")&&e.removeAttr("disabled")},initSortableFields:function(a){a.sortable({items:".simpay-field-metabox",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"simpay-metabox-sortable-placeholder",start:function(a,b){b.item.css("background-color","#f6f6f6")},stop:function(a,b){b.item.removeAttr("style"),spAdminPro.orderFields()}})},addField:function(b){var d,e,f=c.find(".simpay-custom-fields .simpay-field-metabox").length,g=f,h=a(this).closest("#simpay-custom-fields-wrap"),i=h.find(".simpay-metaboxes"),j=["total_amount","payment_button","custom_amount","plan_select"],k=parseInt(c.find("#custom-field-select option:selected").data("counter"))+1,l=c.find("#custom-field-select").val();return i.find(".simpay-field-metabox").each(function(){(a(this).hasClass("simpay-custom-field-payment-button")||a(this).hasClass("simpay-custom-field-custom-amount")||a(this).hasClass("simpay-custom-field-plan-select")||a(this).hasClass("simpay-custom-field-total-amount"))&&g--}),e={action:"simpay_add_field",fieldType:l,counter:k,addFieldNonce:c.find("#simpay_custom_fields_nonce").val()},b.preventDefault(),"payment_button"===l&&c.find(".simpay-custom-field-payment-button").length>0?void alert(spGeneral.i18n.limitPaymentButtonField):"custom_amount"===l&&c.find(".simpay-custom-field-custom-amount").length>0?void alert(spGeneral.i18n.limitCustomAmountField):"plan_select"===l&&c.find(".simpay-custom-field-plan-select").length>0?void alert(spGeneral.i18n.limitPlanSelectField):"coupon"===l&&c.find(".simpay-custom-field-coupon").length>0?void alert(spGeneral.i18n.limitCouponField):"recurring_amount_toggle"===l&&c.find(".simpay-custom-field-recurring-amount-toggle").length>0?void alert(spGeneral.i18n.limitRecurringAmountToggleField):g>=20&&-1===a.inArray(l,j)?void alert(spGeneral.i18n.limitMaxFields):(c.find(".simpay-field-data").each(function(){a(this).is(":visible")&&(a(this).hide(),a(this).addClass("closed"))}),a.ajax({url:ajaxurl,method:"POST",data:e,success:function(b){var c=a("<div/>").append(b);c.find(".field-order").val(f),c.find("input").each(function(){void 0!==(d=a(this).attr("id"))&&a(this).attr("id",d.replace(/(\d+)/,parseInt(k)))}),spAdminPro.orderFields(),i.append(c.html()),"date"===l&&spAdminPro.addDatepicker()},error:function(a){console.log(a)}}),void c.find(".simpay-field-select option").data("counter",k))},removeField:function(b){b.preventDefault(),window.confirm("Are you sure you want to remove this field?")&&a(this).closest(".simpay-field-metabox").remove()},orderFields:function(){a(".simpay-custom-fields .simpay-field-metabox").each(function(b,c){a(".field-order",c).val(parseInt(a(c).index(".simpay-custom-fields .simpay-field-metabox"),10))})},initMetaboxToggle:function(b,c){var d=b.parent();c.preventDefault(),a(c.target).filter(":input, option, .sort").length||(d.hasClass("closed")?d.removeClass("closed"):d.addClass("closed"),b.next(".simpay-metabox-content").stop().slideToggle())},loadCustomFieldMetaboxes:function(){var c=b.find(".simpay-custom-fields"),d=c.find(".simpay-field-metabox").get();d.sort(function(b,c){var d=parseInt(a(b).attr("rel"),10),e=parseInt(a(c).attr("rel"),10);return d<e?-1:d>e?1:0}),a(d).each(function(a,b){c.append(b)}),a(".simpay-metabox.closed").each(function(){a(this).find(".simpay-metabox-content").hide()})},addDatepicker:function(){var b=a(".simpay-date-input");b.datepicker(),b.datepicker("option","dateFormat",spGeneral.strings.dateFormat)},toggleAmountOptions:function(a){var c="",d="",e=a.val(),f=b.find(".simpay-panel-field #_amount_type"),g=f.find('input[type="radio"]'),h=f.find('input[type="radio"]:checked');a.is(":radio")?(c=a.data("disable-amount-check"),d=a.data("disable-amount-single"),void 0!==c&&c!==e||void 0!==d&&d===e?(spAdminPro.setDisabledRadios(g,!0),b.find(".toggle-_amount_type-one_time_set, .toggle-_amount_type-one_time_custom").hide()):(spAdminPro.setDisabledRadios(g,!1),b.find(".toggle-_amount_type-"+h.val()).show())):a.is(":checkbox")&&(a.is(":checked")?(spAdminPro.setDisabledRadios(g,!0),b.find(".toggle-_amount_type-one_time_set, .toggle-_amount_type-one_time_custom").hide()):(spAdminPro.setDisabledRadios(g,!1),b.find(".toggle-_amount_type-"+h.val()).show()))},setDisabledRadios:function(b,c){b.each(function(){c?a(this).attr("disabled","disabled"):a(this).removeAttr("disabled")})}},a(document).ready(function(a){spAdminPro.init()})}(jQuery);