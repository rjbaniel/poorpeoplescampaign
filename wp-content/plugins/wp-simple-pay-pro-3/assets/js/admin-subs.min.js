/*! WP Simple Pay Pro 3 - 3.1.7
 * https://wpsimplepay.com/
 * Copyright (c) Moonstone Media 2017
 * Licensed GPLv2+ */

var spSubAdmin={};!function(a){"use strict";var b,c;spSubAdmin={init:function(){b=a(document.body),c=b.find("#subscription-options-settings-panel"),this.loadMultiPlanSubscriptions(),this.initSortableFields(c.find(".simpay-multi-subscriptions tbody")),c.find(".simpay-add-plan").on("click.simpayAddPlan",function(a){a.preventDefault(),spSubAdmin.addPlan(a)}),c.find(".simpay-panel-field").on("click.simpayRemovePlan",".simpay-remove-plan",function(b){spSubAdmin.removePlan(a(this),b)}),c.find(".simpay-multi-subscriptions").on("click.simpayUpdateDefaultPlan",'.simpay-multi-plan-default input[type="radio"]',function(b){spSubAdmin.updateDefaultPlan(a(this))}),c.find(".simpay-multi-subscriptions").on("change.simpayUpdatePlanSelect",".simpay-multi-plan-select",function(b){spSubAdmin.updatePlanSelect(a(this))}),c.find("#_subscription_custom_amount").find('input[type="radio"]').on("change.simpayToggleSubscription",function(b){spSubAdmin.togglePlans(a(this))}),""===c.find("#simpay-multi-plan-default-value").val()&&c.find('.simpay-multi-plan-default input[type="radio"]:first').trigger("click.simpayUpdateDefaultPlan")},initSortableFields:function(a){a.sortable({items:"tr",cursor:"move",axis:"y",handle:"td.sort-handle",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,stop:function(a,b){spSubAdmin.orderPlans()}})},loadMultiPlanSubscriptions:function(){var b=c.find(".simpay-multi-sub").get();b.sort(function(b,c){var d=parseInt(a(b).attr("rel"),10),e=parseInt(a(c).attr("rel"),10);return d<e?-1:d>e?1:0}),c.find(b).each(function(a,b){c.find(".simpay-multi-subscriptions tbody").append(b)})},togglePlans:function(a){"enabled"===a.val()&&a.is(":checked")?b.find("#_single_plan").attr("disabled","disabled").trigger("chosen:updated"):b.find("#_single_plan").removeAttr("disabled").trigger("chosen:updated")},updatePlanSelect:function(a){var b=a.parent().data("field-key");c.find("#simpay-subscription-multi-plan-default-"+b+"-yes").is(":checked")&&c.find("#simpay-multi-plan-default-value").val(a.find("option:selected").val())},updateDefaultPlan:function(a){var b=a.closest(".simpay-multi-plan-default").parent().find(".simpay-multi-plan-select").find("option:selected").val();c.find("#simpay-multi-plan-default-value").val(b)},orderPlans:function(){c.find(".simpay-multi-sub").each(function(b,d){c.find(".plan-order",d).val(parseInt(a(d).index(".simpay-multi-sub"),10))})},addPlan:function(d){var e=(c.find(".simpay-multi-subscriptions tbody tr").length,c.find(".simpay-multi-subscriptions tbody")),f=parseInt(c.find(".simpay-multi-sub:last").data("field-key"))+1,g={action:"simpay_add_plan",counter:f,addPlanNonce:b.find("#simpay_add_plan_nonce").val()};d.preventDefault(),a.ajax({url:ajaxurl,method:"POST",data:g,success:function(a){e.append(a),e.find("select").chosen()},error:function(a){console.log(a)}})},removePlan:function(a,b){b.preventDefault(),a.closest(".simpay-multi-sub").remove()}},a(document).ready(function(a){spSubAdmin.init()})}(jQuery);